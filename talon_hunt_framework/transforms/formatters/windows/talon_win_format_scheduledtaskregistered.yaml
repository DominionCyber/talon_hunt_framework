name: talon_win_format_scheduledtaskregistered
description: Formats ScheduledTaskRegistered XML data into human-readable task details.
visualization:
  options:
    columns:
    - fieldName: '@timestamp'
      format: datetime
      type: field
      width: 200
    - groupByPrefix: false
      header: Field List
      type: fieldList
    newestAtBottom: true
    showOnlyFirstLine: false
  type: list-view
labels:
- talon_hunt_framework
- asset
- format
- scheduledtaskregistered
- windows
$schema: https://schemas.humio.com/query/v0.6.0
timeInterval:
  isLive: false
  start: 15m
queryString: |-
  // =====================================================
  // FORMATTING
  // =====================================================
  | parseXml(TaskXml)
  | replace("\\\\u0009|\\\\u000a|\\\\u000b|\\\\u000c|\\\\u000d|\\\\u001f|\\\\u007f|\\\\u0085|\\\\u00a0|\\\\u200b|\\\\u200c|\\\\u200d|\\\\ufeff|\\s\\s+", with="", field=Task.Actions.ComHandler.ClassId)
  | replace("\\\\u0009|\\\\u000a|\\\\u000b|\\\\u000c|\\\\u000d|\\\\u001f|\\\\u007f|\\\\u0085|\\\\u00a0|\\\\u200b|\\\\u200c|\\\\u200d|\\\\ufeff|\\s\\s+", with="", field=Task.Actions.ComHandler.Data)
  | replace("\\\\u0009|\\\\u000a|\\\\u000b|\\\\u000c|\\\\u000d|\\\\u001f|\\\\u007f|\\\\u0085|\\\\u00a0|\\\\u200b|\\\\u200c|\\\\u200d|\\\\ufeff|\\s\\s+", with="", field=Task.Actions.Exec.Arguments)
  | replace("\\\\u0009|\\\\u000a|\\\\u000b|\\\\u000c|\\\\u000d|\\\\u001f|\\\\u007f|\\\\u0085|\\\\u00a0|\\\\u200b|\\\\u200c|\\\\u200d|\\\\ufeff|\\s\\s+", with="", field=Task.Actions.Exec.Command)
  | replace("\\\\u0009|\\\\u000a|\\\\u000b|\\\\u000c|\\\\u000d|\\\\u001f|\\\\u007f|\\\\u0085|\\\\u00a0|\\\\u200b|\\\\u200c|\\\\u200d|\\\\ufeff|\\s\\s+", with="", field=Task.Principals.Principal.LogonType)
  | replace("\\\\u0009|\\\\u000a|\\\\u000b|\\\\u000c|\\\\u000d|\\\\u001f|\\\\u007f|\\\\u0085|\\\\u00a0|\\\\u200b|\\\\u200c|\\\\u200d|\\\\ufeff|\\s\\s+", with="", field=Task.Principals.Principal.RunLevel)
  | replace("\\\\u0009|\\\\u000a|\\\\u000b|\\\\u000c|\\\\u000d|\\\\u001f|\\\\u007f|\\\\u0085|\\\\u00a0|\\\\u200b|\\\\u200c|\\\\u200d|\\\\ufeff|\\s\\s+", with="", field=Task.Principals.Principal.UserId)
  | replace("\\\\u0009|\\\\u000a|\\\\u000b|\\\\u000c|\\\\u000d|\\\\u001f|\\\\u007f|\\\\u0085|\\\\u00a0|\\\\u200b|\\\\u200c|\\\\u200d|\\\\ufeff|\\s\\s+", with="", field=Task.Settings.Enabled)
  | replace("\\\\u0009|\\\\u000a|\\\\u000b|\\\\u000c|\\\\u000d|\\\\u001f|\\\\u007f|\\\\u0085|\\\\u00a0|\\\\u200b|\\\\u200c|\\\\u200d|\\\\ufeff|\\s\\s+", with="", field=Task.Settings.Hidden)
  | replace("\\\\u0009|\\\\u000a|\\\\u000b|\\\\u000c|\\\\u000d|\\\\u001f|\\\\u007f|\\\\u0085|\\\\u00a0|\\\\u200b|\\\\u200c|\\\\u200d|\\\\ufeff|\\s\\s+", with="", field=Task.Settings.Priority)
  | replace("\\\\u0009|\\\\u000a|\\\\u000b|\\\\u000c|\\\\u000d|\\\\u001f|\\\\u007f|\\\\u0085|\\\\u00a0|\\\\u200b|\\\\u200c|\\\\u200d|\\\\ufeff|\\s\\s+", with="", field=Task.Settings.RunOnlyIfNetworkAvailable)
  | replace("\\\\u0009|\\\\u000a|\\\\u000b|\\\\u000c|\\\\u000d|\\\\u001f|\\\\u007f|\\\\u0085|\\\\u00a0|\\\\u200b|\\\\u200c|\\\\u200d|\\\\ufeff|\\s\\s+", with="", field=Task.Triggers.BootTrigger)
  | replace("\\\\u0009|\\\\u000a|\\\\u000b|\\\\u000c|\\\\u000d|\\\\u001f|\\\\u007f|\\\\u0085|\\\\u00a0|\\\\u200b|\\\\u200c|\\\\u200d|\\\\ufeff|\\s\\s+", with="", field=Task.Triggers.BootTrigger.Enabled)
  | replace("\\\\u0009|\\\\u000a|\\\\u000b|\\\\u000c|\\\\u000d|\\\\u001f|\\\\u007f|\\\\u0085|\\\\u00a0|\\\\u200b|\\\\u200c|\\\\u200d|\\\\ufeff|\\s\\s+", with="", field=Task.Triggers.BootTrigger.Repetition.Interval)
  | replace("\\\\u0009|\\\\u000a|\\\\u000b|\\\\u000c|\\\\u000d|\\\\u001f|\\\\u007f|\\\\u0085|\\\\u00a0|\\\\u200b|\\\\u200c|\\\\u200d|\\\\ufeff|\\s\\s+", with="", field=Task.Triggers.CalendarTrigger.Enabled)
  | replace("\\\\u0009|\\\\u000a|\\\\u000b|\\\\u000c|\\\\u000d|\\\\u001f|\\\\u007f|\\\\u0085|\\\\u00a0|\\\\u200b|\\\\u200c|\\\\u200d|\\\\ufeff|\\s\\s+", with="", field=Task.Triggers.CalendarTrigger.Repetition.Interval)
  | replace("\\\\u0009|\\\\u000a|\\\\u000b|\\\\u000c|\\\\u000d|\\\\u001f|\\\\u007f|\\\\u0085|\\\\u00a0|\\\\u200b|\\\\u200c|\\\\u200d|\\\\ufeff|\\s\\s+", with="", field=Task.Triggers.EventTrigger.Enabled)
  | replace("\\\\u0009|\\\\u000a|\\\\u000b|\\\\u000c|\\\\u000d|\\\\u001f|\\\\u007f|\\\\u0085|\\\\u00a0|\\\\u200b|\\\\u200c|\\\\u200d|\\\\ufeff|\\s\\s+", with="", field=Task.Triggers.EventTrigger.Subscription)
  | replace("\\\\u0009|\\\\u000a|\\\\u000b|\\\\u000c|\\\\u000d|\\\\u001f|\\\\u007f|\\\\u0085|\\\\u00a0|\\\\u200b|\\\\u200c|\\\\u200d|\\\\ufeff|\\s\\s+", with="", field=Task.Triggers.IdleTrigger.Enabled)
  | replace("\\\\u0009|\\\\u000a|\\\\u000b|\\\\u000c|\\\\u000d|\\\\u001f|\\\\u007f|\\\\u0085|\\\\u00a0|\\\\u200b|\\\\u200c|\\\\u200d|\\\\ufeff|\\s\\s+", with="", field=Task.Triggers.LogonTrigger)
  | replace("\\\\u0009|\\\\u000a|\\\\u000b|\\\\u000c|\\\\u000d|\\\\u001f|\\\\u007f|\\\\u0085|\\\\u00a0|\\\\u200b|\\\\u200c|\\\\u200d|\\\\ufeff|\\s\\s+", with="", field=Task.Triggers.LogonTrigger.Enabled)
  | replace("\\\\u0009|\\\\u000a|\\\\u000b|\\\\u000c|\\\\u000d|\\\\u001f|\\\\u007f|\\\\u0085|\\\\u00a0|\\\\u200b|\\\\u200c|\\\\u200d|\\\\ufeff|\\s\\s+", with="", field=Task.Triggers.LogonTrigger.Repetition.Interval)
  | replace("\\\\u0009|\\\\u000a|\\\\u000b|\\\\u000c|\\\\u000d|\\\\u001f|\\\\u007f|\\\\u0085|\\\\u00a0|\\\\u200b|\\\\u200c|\\\\u200d|\\\\ufeff|\\s\\s+", with="", field=Task.Triggers.LogonTrigger.UserId)
  | replace("\\\\u0009|\\\\u000a|\\\\u000b|\\\\u000c|\\\\u000d|\\\\u001f|\\\\u007f|\\\\u0085|\\\\u00a0|\\\\u200b|\\\\u200c|\\\\u200d|\\\\ufeff|\\s\\s+", with="", field=Task.Triggers.RegistrationTrigger)
  | replace("\\\\u0009|\\\\u000a|\\\\u000b|\\\\u000c|\\\\u000d|\\\\u001f|\\\\u007f|\\\\u0085|\\\\u00a0|\\\\u200b|\\\\u200c|\\\\u200d|\\\\ufeff|\\s\\s+", with="", field=Task.Triggers.RegistrationTrigger.Enabled)
  | replace("\\\\u0009|\\\\u000a|\\\\u000b|\\\\u000c|\\\\u000d|\\\\u001f|\\\\u007f|\\\\u0085|\\\\u00a0|\\\\u200b|\\\\u200c|\\\\u200d|\\\\ufeff|\\s\\s+", with="", field=Task.Triggers.RegistrationTrigger.Repetition.Interval)
  | replace("\\\\u0009|\\\\u000a|\\\\u000b|\\\\u000c|\\\\u000d|\\\\u001f|\\\\u007f|\\\\u0085|\\\\u00a0|\\\\u200b|\\\\u200c|\\\\u200d|\\\\ufeff|\\s\\s+", with="", field=Task.Triggers.SessionStateChangeTrigger)
  | replace("\\\\u0009|\\\\u000a|\\\\u000b|\\\\u000c|\\\\u000d|\\\\u001f|\\\\u007f|\\\\u0085|\\\\u00a0|\\\\u200b|\\\\u200c|\\\\u200d|\\\\ufeff|\\s\\s+", with="", field=Task.Triggers.SessionStateChangeTrigger.Enabled)
  | replace("\\\\u0009|\\\\u000a|\\\\u000b|\\\\u000c|\\\\u000d|\\\\u001f|\\\\u007f|\\\\u0085|\\\\u00a0|\\\\u200b|\\\\u200c|\\\\u200d|\\\\ufeff|\\s\\s+", with="", field=Task.Triggers.SessionStateChangeTrigger.Repetition.Interval)
  | replace("\\\\u0009|\\\\u000a|\\\\u000b|\\\\u000c|\\\\u000d|\\\\u001f|\\\\u007f|\\\\u0085|\\\\u00a0|\\\\u200b|\\\\u200c|\\\\u200d|\\\\ufeff|\\s\\s+", with="", field=Task.Triggers.SessionStateChangeTrigger.StateChange)
  | replace("\\\\u0009|\\\\u000a|\\\\u000b|\\\\u000c|\\\\u000d|\\\\u001f|\\\\u007f|\\\\u0085|\\\\u00a0|\\\\u200b|\\\\u200c|\\\\u200d|\\\\ufeff|\\s\\s+", with="", field=Task.Triggers.TimeTrigger.Enabled)
  | replace("\\\\u0009|\\\\u000a|\\\\u000b|\\\\u000c|\\\\u000d|\\\\u001f|\\\\u007f|\\\\u0085|\\\\u00a0|\\\\u200b|\\\\u200c|\\\\u200d|\\\\ufeff|\\s\\s+", with="", field=Task.Triggers.TimeTrigger.Repetition.Interval)
  | replace("\\\\u0009|\\\\u000a|\\\\u000b|\\\\u000c|\\\\u000d|\\\\u001f|\\\\u007f|\\\\u0085|\\\\u00a0|\\\\u200b|\\\\u200c|\\\\u200d|\\\\ufeff|\\s\\s+", with="", field=Task.Triggers.WnfStateChangeTrigger)
  | replace("\\\\u0009|\\\\u000a|\\\\u000b|\\\\u000c|\\\\u000d|\\\\u001f|\\\\u007f|\\\\u0085|\\\\u00a0|\\\\u200b|\\\\u200c|\\\\u200d|\\\\ufeff|\\s\\s+", with="", field=Task.Triggers.WnfStateChangeTrigger.Enabled)
