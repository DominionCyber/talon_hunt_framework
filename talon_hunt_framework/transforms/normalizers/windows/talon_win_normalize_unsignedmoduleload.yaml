name: talon_win_normalize_unsignedmoduleload
description: Normalizes event fields using conditional logic to standardize values across different event sources.
visualization:
  options:
    columns:
    - fieldName: '@timestamp'
      format: datetime
      type: field
      width: 200
    - groupByPrefix: false
      header: Field List
      type: fieldList
    newestAtBottom: true
    showOnlyFirstLine: false
  type: list-view
labels:
- talon_hunt_framework
- asset
- normalize
- unsignedmoduleload
- windows
$schema: https://schemas.humio.com/query/v0.6.0
timeInterval:
  isLive: false
  start: 15m
queryString: |-
  // =====================================================
  // NORMALIZATION
  // =====================================================
  | case {
      MappedFromUserMode = "0" | MappedFromUserMode := "KERNEL";
      MappedFromUserMode > "0" | MappedFromUserMode := "USER";
      *
  }

  | bitfield:extractFlagsAsString(
      field="ModuleCharacteristics",
      flagNames=[
          [0,  "RELOCS_STRIPPED"],
          [1,  "EXECUTABLE_IMAGE"],
          [2,  "LINE_NUMS_STRIPPED"],
          [3,  "LOCAL_SYMS_STRIPPED"],
          [4,  "AGGRESSIVE_WS_TRIM"],
          [5,  "LARGE_ADDRESS_AWARE"],
          [6,  "BYTES_RESERVED_LO"],
          [7,  "_32BIT_MACHINE"],
          [8,  "DEBUG_STRIPPED"],
          [9,  "REMOVABLE_RUN_FROM_SWAP"],
          [10, "NET_RUN_FROM_SWAP"],
          [11, "FILE_SYSTEM"],
          [12, "FILE_DLL"],
          [13, "UP_SYSTEM_ONLY"],
          [14, "BYTES_RESERVED_HI"]
      ],
      as="ModuleCharacteristics_mask",
      separator=", "
  )
