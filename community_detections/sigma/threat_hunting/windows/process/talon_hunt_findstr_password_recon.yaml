name: talon_hunt_findstr_password_recon
description: Detects command line usage of "findstr" to search for password keywords in multiple languages. Common privilege escalation technique for credential harvesting from config files and scripts. Adapted from Sigma rule 1a0f6f16-2099-4753-9a02-43b6ac7a1fa5.
visualization:
  options:
  cell-overflow: wrap-text
  column-overflow: truncate
  configured-columns: {}
  row-numbers-enabled: false
  type: table-view
labels:
- talon_hunt_framework
- hunt
- processrollup2
- syntheticprocessrollup2
- windows
- threat_hunt
- credential_access
- t1552.001
- sigma
- medium_signal
$schema: https://schemas.humio.com/query/v0.6.0
timeInterval:
  isLive: false
  start: 15m
queryString: |-
  // =====================================================
  // SEARCH
  // =====================================================
  #event_simpleName=/ProcessRollup2|SyntheticProcessRollup2/ event_platform=Win
  | FileName=/findstr\.exe/i OR OriginalFilename=/findstr\.exe/i
  // findstr.exe: native Windows grep equivalent - commonly abused post-exploit to harvest creds from configs, scripts, and docs
  | CommandLine=/contraseña|hasło|heslo|parola|passe|passw|senha|senord|密碼/i
  // Multilingual password keywords: Spanish(contraseña), Polish(hasło), Czech(heslo), Italian(parola), French(passe), German/English(passw), Portuguese(senha), Swedish(senord), Cantonese(密碼)

  // =====================================================
  // SEARCH ASSETS
  // =====================================================
  | $talon_convert_time_utc()
  | $talon_utility_falcon_helper()
  | $talon_win_format_callstackmodules()
  | $talon_win_normalize_file_path(TargetField=FilePath)
  | $talon_win_normalize_file_path(TargetField=CallStackModules)
  | $talon_win_normalize_nt_authority_system_user()
  | $talon_win_normalize_processrollup2()

  // =====================================================
  // TABLE
  // =====================================================
  | table(
      [
          utc_time,
          ComputerName,
          UserName,
          GrandParentBaseFileName,
          ParentBaseFileName,
          FilePath,
          FileName,
          CommandLine,
          SHA256HashData,
          CallStackModules,
          HostUrl,
          RefererUrl,
          OriginalFilename,
          SessionId,
          ImageSubsystem,
          IntegrityLevel,
          CreateProcessType,
          ProcessCreateFlags,
          ProcessCreateFlags_mask,
          ProcessParameterFlags,
          ProcessParameterFlags_mask,
          ProcessSxsFlags,
          ProcessSxsFlags_mask,
          RawProcessId,
          SignInfoFlags,
          SignInfoFlags_mask
      ],
      limit=max
  )
