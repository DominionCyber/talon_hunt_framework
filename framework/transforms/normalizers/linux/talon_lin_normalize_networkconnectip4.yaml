name: talon_lin_normalize_networkconnectip4
description: Normalizes event fields using conditional logic to standardize values across different event sources.
visualization:
  options:
    columns:
    - fieldName: '@timestamp'
      format: datetime
      type: field
      width: 200
    - groupByPrefix: false
      header: Field List
      type: fieldList
    newestAtBottom: true
    showOnlyFirstLine: false
  type: list-view
labels:
- talon_hunt_framework
- asset
- normalize
- networkconnectip4
- linux
$schema: https://schemas.humio.com/query/v0.6.0
timeInterval:
  isLive: false
  start: 15m
queryString: |-
  // =====================================================
  // NORMALIZATION
  // =====================================================

  | case {
    Protocol=0   | Protocol:="IP";
    Protocol=1   | Protocol:="ICMP";
    Protocol=2   | Protocol:="IGMP";
    Protocol=6   | Protocol:="TCP";
    Protocol=17  | Protocol:="UDP";
    Protocol=41  | Protocol:="IPV6";
    Protocol=47  | Protocol:="GRE";
    Protocol=58  | Protocol:="ICMPV6";
    Protocol=255 | Protocol:="UNKNOWN";
    *
  }

  | case {
    ConnectionDirection=0 | ConnectionDirection:="OUTBOUND";
    ConnectionDirection=1 | ConnectionDirection:="INBOUND";
    ConnectionDirection=2 | ConnectionDirection:="NEITHER";
    ConnectionDirection=3 | ConnectionDirection:="INBOUND_OUTBOUND";
    ConnectionDirection=4 | ConnectionDirection:="UNKNOWN";
    *
  }

  | bitfield:extractFlagsAsString(
      field="ConnectionFlags",
      flagNames=[
        [0, "RAW_SOCKET"],
        [1, "PROMISCUOUS_MODE_SIO_RCVALL"],
        [2, "PROMISCUOUS_MODE_SIO_RCVALL_IGMPMCAST"],
        [3, "PROMISCUOUS_MODE_SIO_RCVALL_MCAST"],
        [4, "IS_LOOPBACK"]
      ],
      as="ConnectionFlags_mask",
      separator=", "
    )
