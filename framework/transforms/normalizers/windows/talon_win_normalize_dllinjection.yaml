name: talon_win_normalize_dllinjection
description: Normalizes and standardizes event fields for consistent downstream processing.
visualization:
  options:
    columns:
    - fieldName: '@timestamp'
      format: datetime
      type: field
      width: 200
    - groupByPrefix: false
      header: Field List
      type: fieldList
    newestAtBottom: true
    showOnlyFirstLine: false
  type: list-view
labels:
- talon_hunt_framework
- asset
- normalize
- dllinjection
- windows
$schema: https://schemas.humio.com/query/v0.6.0
timeInterval:
  isLive: false
  start: 15m
queryString: |-
  // =====================================================
  // NORMALIZATION
  // =====================================================
  | bitfield:extractFlagsAsString(
      field="InjectedThreadFlag",
      flagNames=[
          [0, "PREV_MODE_KERNEL"],
          [1, "START_ADDRESS_IN_NAMED_PE"],
          [2, "START_ADDRESS_IN_SYS_RANGE"],
          [3, "SYSTEM_THREAD"],
          [4, "SOURCE_PROCESS_IS_SYSTEM"],
          [5, "TARGET_ANALYSIS_FAILED"],
          [6, "CONTEXT_ANALYSIS_FAILED"],
          [7, "START_ADDRESS_IN_NTDLL"],
          [8, "START_ADDRESS_IN_WIN_DLL"],
          [9, "START_ADDRESS_PRIVATE_MEM"]
      ],
      as="InjectedThreadFlag_mask",
      separator=", "
    )
