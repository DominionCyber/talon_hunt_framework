name: talon_convert_file_size
description: Converts byte values to human-readable format (TB/GB/MB/KB/Bytes) using cascading thresholds. Test 123.
visualization:
  options:
    columns:
    - fieldName: '@timestamp'
      format: datetime
      type: field
      width: 200
    - groupByPrefix: false
      header: Field List
      type: fieldList
    newestAtBottom: true
    showOnlyFirstLine: false
  type: list-view
labels:
- talon_hunt_framework
- asset
- convert
- file_size
$schema: https://schemas.humio.com/query/v0.6.0
timeInterval:
  isLive: false
  start: 15m
queryString: |-
  // =====================================================
  // CONVERSION
  // =====================================================
  | ByteSize := coalesce([ModuleSize, Size])
  | case {
      ByteSize >= 1099511627776
    | CommonSize := unit:convert(ByteSize, to=T)
    | format("%,.2f TB", field=["CommonSize"], as="CommonSize");
      ByteSize >= 1073741824
    | CommonSize := unit:convert(ByteSize, to=G)
    | format("%,.2f GB", field=["CommonSize"], as="CommonSize");
      ByteSize >= 1048576
    | CommonSize := unit:convert(ByteSize, to=M)
    | format("%,.2f MB", field=["CommonSize"], as="CommonSize");
      ByteSize > 1024
    | CommonSize := unit:convert(ByteSize, to=k)
    | format("%,.3f KB", field=["CommonSize"], as="CommonSize");
      *
    | CommonSize := format("%,.0f Bytes", field=["ByteSize"]);
  }
